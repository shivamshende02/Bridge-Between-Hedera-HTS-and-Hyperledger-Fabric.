package com.shivam.hedera;

import com.hedera.hashgraph.sdk.*;
import io.github.cdimascio.dotenv.Dotenv;
import java.util.concurrent.TimeoutException;

public class TokenAssociation {
    public static void main(String[] args) throws TimeoutException, PrecheckStatusException, ReceiptStatusException {

        // Load operator details
        Dotenv dotenv = Dotenv.load();
        AccountId operatorId = AccountId.fromString(dotenv.get("OPERATOR_ID"));
        PrivateKey operatorKey = PrivateKey.fromString(dotenv.get("OPERATOR_KEY"));

        Client client = Client.forTestnet();
        client.setOperator(operatorId, operatorKey);

        // Contract and token IDs
        ContractId contractId = ContractId.fromString("0.0.6791530");   // Your deployed contract
        TokenId tokenId = TokenId.fromString("0.0.6460709");            // The token to associate

        // Call the associateNewToken function in the contract
        ContractExecuteTransaction tx = new ContractExecuteTransaction()
            .setContractId(contractId)
            .setGas(2_000_000)
            .setFunction(
                "associateNewToken",
                new ContractFunctionParameters().addAddress(tokenId.toSolidityAddress())  // must be solidity address
            )
            .freezeWith(client)
            .sign(operatorKey);

        TransactionResponse resp = tx.execute(client);
        TransactionReceipt receipt = resp.getReceipt(client);

        System.out.println("Contract association status: " + receipt.status);
    }
}
